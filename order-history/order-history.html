<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ | Football Store</title>
  <link rel="stylesheet" href="order-history.css" />
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a2e0b2df3a.js" crossorigin="anonymous"></script>
</head>
<body>

  <!-- üîπ ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô -->
  <header class="navbar">
    <div class="logo">
      <img src="../uploads/h0-Photoroom.jpg" alt="Football Logo">
      <span>Football Store</span>
    </div>

    <nav>
      <a href="../index/index.html">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      <a href="../Product/basket.html">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</a>
      <a href="order-history.html" class="active">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</a>
    </nav>

    <div class="profile-section">
      <img src="../uploads/iconprofile.jpg" alt="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå" id="profileIcon" class="profile-icon" />
      <div class="dropdown" id="profileDropdown">
        <div class="profile-info">
          <img id="userImg" src="../uploads/iconprofile.jpg" alt="User Image" />
          <h4 id="userFullname">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h4>
          <p id="userEmail">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        </div>
        <div class="profile-buttons">
          <button class="edit-btn" onclick="window.location.href='../Edit_profile/edit_profile.html'">
            <i class="fas fa-user-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
          </button>
          <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- üîπ ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
  <div class="container">
    <h1>üõçÔ∏è ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
    <div id="ordersContainer"></div>
  </div>
  <script>
    const profileIcon = document.getElementById("profileIcon");
    const profileDropdown = document.getElementById("profileDropdown");

    profileIcon.addEventListener("click", () => {
      profileDropdown.classList.toggle("show");
    });

    document.addEventListener("click", (e) => {
      if (!profileDropdown.contains(e.target) && e.target !== profileIcon) {
        profileDropdown.classList.remove("show");
      }
    });

    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å database
    window.addEventListener("DOMContentLoaded", () => {
      fetch('../index/check_login.php')
        .then(res => res.json())
        .then(user => {
          if (!user.loggedIn) {
            document.getElementById("userFullname").textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
            document.getElementById("userEmail").textContent = "";
            return;
          }
          document.getElementById("userFullname").textContent = `${user.firstname} ${user.lastname}`;
          document.getElementById("userEmail").textContent = user.email;
          document.getElementById("userImg").src = "../uploads/iconprofile.jpg";
          document.getElementById("profileIcon").src = "../uploads/iconprofile.jpg";
          // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (payments)
          fetch('order-history.php')
            .then(res => res.json())
            .then(data => {
              const orders = data.orders || [];
              const container = document.getElementById("ordersContainer");
              if (!orders.length) {
                container.innerHTML = "<div style='text-align:center;color:#888;padding:40px;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>";
                return;
              }
              container.innerHTML = orders.map(order => {
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                let statusClass = "";
                if (order.status === "‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á") statusClass = "status-success";
                else if (order.status && order.status.includes("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å")) statusClass = "status-cancel";
                return `
                <div class="order-card">
                  <div class="order-header">
                    <h2>Order #${order.order_number}</h2>
                    <span class="status ${statusClass}">${order.status}</span>
                  </div>
                  <p class="order-date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: ${order.created_at}</p>
                  <div class="order-items">
                    <div class="item"><span>${order.product_name} (${order.stock_out} ‡∏ä‡∏¥‡πâ‡∏ô)</span><span>‡∏ø${Number(order.amount).toLocaleString()}</span></div>
                    <hr>
                    <div class="total"><strong>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong><strong>‡∏ø${Number(order.amount).toLocaleString()}</strong></div>
                  </div>
                  <div class="actions">
                    <button class="btn view" onclick="viewOrder('${order.order_number}')">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                  </div>
                </div>
                `;
              }).join('');
            });
        })
        .catch(console.error);
    });

    function logout() {
      window.location.href = "../Login/Login.html";
    }
    function viewOrder(orderNumber) {
      alert("‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î Order #" + orderNumber);
      // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ
    }
  </script>
  <style>
    /* ...existing code... */
    .status-success {
      background: #c8e6c9;
      color: #388e3c !important;
      padding: 4px 12px;
      border-radius: 12px;
      font-weight: 700;
      display: inline-block;
    }
    .status-cancel {
      background: #ffcdd2;
      color: #d32f2f !important;
      padding: 4px 12px;
      border-radius: 12px;
      font-weight: 700;
      display: inline-block;
    }
    /* ...existing code... */
  </style>
</body>
</html>
