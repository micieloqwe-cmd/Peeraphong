<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô | Football Store Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="Admin_Payment.css">
</head>

<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Football Store</h2>
      <span>Admin Panel</span>
    </div>
    <div class="admin-profile">
      <img src="../uploads/Admin.jpg" alt="">
      <div class="admin-name">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</div>
      <div class="admin-email" id="adminProfileEmail">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>
    <ul class="menu">
      <li id="dashboardMenu"><i class="fas fa-chart-line"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</li>
      <li id="productMenu"><i class="fas fa-box"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</li>
      <li class="active" id="paymentMenu"><i class="fas fa-credit-card"></i> ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</li>
      <li id="reportMenu"><i class="fas fa-file-alt"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</li>
      <li id="profileMenu"><i class="fas fa-user"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</li>
    </ul>
    <button class="logout" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>

  <!-- ========== Main Content ========== -->
  <main class="main-content">
    <header>
      <h1><i class="fas fa-credit-card"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h1>
    </header>

    <!-- Summary Cards -->
    <section class="summary">
      <div class="card total">
        <h3>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <p id="totalCount">0</p>
      </div>
      <div class="card waiting">
        <h3>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <p id="cancelCount">0</p>
      </div>
      <div class="card checking">
        <h3>‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h3>
        <p id="checkingCount">0</p>
      </div>
      <div class="card success">
        <h3>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</h3>
        <p id="successCount">0</p>
      </div>
      <div class="card" style="border-left:5px solid #0ea5e9;">
        <h3>‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß</h3>
        <p id="prepareCount">0</p>
      </div>
    </section>

    <!-- Search and Filter -->
    <div class="filter-bar">
      <input type="text" id="search" placeholder="üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠, ‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞ ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..." autocomplete="off">
      <select id="filterStatus">
        <option value="">üóÇ ‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
        <option value="‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
        <option value="‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</option>
        <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</option>
        <option value="‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
      </select>
    </div>

    <!-- Table -->
    <section class="table-section">
      <table>
        <thead>
          <tr>
            <th>‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞</th>
            <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</th>
            <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th>‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</th>
            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="paymentTable">
          <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏î‡∏¢ JS -->
        </tbody>
      </table>
    </section>
  </main>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <h2 style="text-align:center;margin-bottom:18px;">
        <i class="fas fa-truck-moving" style="color:#0ea5e9;margin-right:8px;"></i>
        ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
      </h2>
      <div class="info" style="background:#f8fafc;padding:18px 18px 10px 18px;border-radius:14px;border:1px solid #e5eaf0;margin-bottom:18px;">
        <div style="display:flex;flex-wrap:wrap;gap:12px 24px;">
          <div style="flex:1 1 220px;">
            <p><b>‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞:</b> <span id="mPay"></span></p>
            <p><b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</b> <span id="mOrder"></span></p>
            <p><b>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</b> <span id="mEmail"></span></p>
            <p><b>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</b> <span id="mName"></span></p>
            <p><b>‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞:</b> <span id="mAmount"></span></p>
            <p><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b>
              <span id="mStatus" style="font-weight:700;color:#0ea5e9;background:#e6f6ff;padding:3px 12px;border-radius:8px;"></span>
            </p>
          </div>
          <div style="flex:0 0 150px;display:flex;align-items:center;justify-content:center;">
            <div style="border:1px solid #e5eaf0; border-radius:14px; padding:8px; background:#f8fafc;">
              <img id="mSlip" src="" class="slip-preview" style="width:120px;height:120px;object-fit:cover;" onclick="openSlip(this.src)">
            </div>
          </div>
        </div>
      </div>
      <div style="margin-bottom:18px;">
        <label style="font-weight:700;color:#0ea5e9;display:block;margin-bottom:6px;">
          <i class="fas fa-exchange-alt"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà:
        </label>
        <select id="statusSelect" style="width:100%;padding:12px 10px;border-radius:8px;border:1px solid #cfe0ff;font-size:16px;">
          <option value="‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
          <option value="‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
          <option value="‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß</option>
          <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</option>
        </select>
      </div>
      <button class="btn-save" onclick="saveStatus()" style="font-size:18px;padding:13px 0;margin-top:8px;">
        <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      </button>
    </div>
  </div>

  <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° popup ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ slip -->
  <div id="popup">
    <button id="popupClose" onclick="closeSlip()">&times;</button>
    <img id="popupImg" src="">
  </div>

  <script>
    // ================== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ ==================
    function openSlip(src) {
      const popup = document.getElementById("popup");
      document.getElementById("popupImg").src = src;
      popup.classList.add("show");
    }
    function closeSlip() {
      document.getElementById("popup").classList.remove("show");
    }

    // ================== Modal ==================
    function openModal(btn) {
      const row = btn.closest("tr").children;
      document.getElementById("mPay").textContent = row[0].textContent;
      document.getElementById("mOrder").textContent = row[1].textContent;
      document.getElementById("mEmail").textContent = row[2].textContent;
      document.getElementById("mName").textContent = row[3].textContent;
      document.getElementById("mAmount").textContent = row[6].textContent;
      // ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏≤‡∏Å span
      const statusSpan = row[7].querySelector(".status");
      const currentStatus = statusSpan ? statusSpan.textContent.trim() : row[7].textContent.trim();
      document.getElementById("mStatus").textContent = currentStatus;
      // ‡∏î‡∏∂‡∏á path ‡∏™‡∏•‡∏¥‡∏õ‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô cell
      const slipBtn = row[8].querySelector("button");
      document.getElementById("mSlip").src = slipBtn ? slipBtn.getAttribute("onclick").match(/'([^']+)'/)[1] : "";
      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ select ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÉ‡∏ä‡πâ value)
      const statusSelect = document.getElementById("statusSelect");
      let found = false;
      for (let i = 0; i < statusSelect.options.length; i++) {
        if (
          statusSelect.options[i].value === currentStatus
        ) {
          statusSelect.selectedIndex = i;
          found = true;
          break;
        }
      }
      if (!found) statusSelect.selectedIndex = 0;
      document.getElementById("modal").classList.add("show");
    }
    function closeModal() { document.getElementById("modal").classList.remove("show"); }

    // ================== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ==================
    function saveStatus() {
      const newStatus = document.getElementById("statusSelect").value;
      const paymentCode = document.getElementById("mPay").textContent;
      fetch("Admin_Payment.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `edit_status=1&payment_code=${encodeURIComponent(paymentCode)}&new_status=${encodeURIComponent(newStatus)}`
      })
        .then(async res => {
          const raw = await res.text();
          try {
            const data = JSON.parse(raw);
            if (data.success) {
              alert("‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô: " + newStatus);
              closeModal();
              loadPayments();
            } else {
              alert("‚ùå " + (data.message || "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"));
            }
          } catch (err) {
            console.error("JSON parse error:", raw);
            alert("‚ùå ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n\n" + raw);
          }
        })
        .catch(err => {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: " + err);
        });
    }

    // ================== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ==================
    const search = document.getElementById("search");
    const filter = document.getElementById("filterStatus");

    function filterTable() {
      const q = search.value.toLowerCase();
      const s = filter.value;
      const rows = document.querySelectorAll("#paymentTable tr");
      rows.forEach(r => {
        const rowText = r.innerText.toLowerCase();
        const matchText = rowText.includes(q);
        let matchStatus = true;
        if (s === "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö") {
          matchStatus = r.dataset.status === "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö";
        } else if (s) {
          matchStatus = r.dataset.status === s;
        }
        r.style.display = matchText && matchStatus ? "" : "none";
      });
    }

    search.addEventListener("keyup", filterTable);
    filter.addEventListener("change", filterTable);

    // ================== ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Backend ==================
    function loadPayments() {
      fetch("Admin_Payment.php?get_all_payments=1")
        .then(async res => {
          const data = await res.json();
          const tbody = document.getElementById("paymentTable");
          tbody.innerHTML = "";

          let total = 0, cancel = 0, checking = 0, success = 0, prepare = 0;

          const orders = data.orders || [];
          const payments = data.payments || [];

          const paymentMap = {};
          payments.forEach(pay => {
            if (pay.order_number) paymentMap[pay.order_number] = pay;
          });

          if (data.success && Array.isArray(orders)) {
            total = orders.length;
            orders.forEach(order => {
              if (order.status === "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö") cancel++;
              if (order.status === "‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö") checking++;
              if (order.status === "‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á") success++;
              if (order.status === "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß") prepare++;

              let statusClass = "pending";
              if (order.status === "‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á") statusClass = "success";
              else if (order.status === "‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö") statusClass = "waiting";
              else if (order.status === "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö") statusClass = "cancel";
              else if (order.status === "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß") statusClass = "info";

              const pay = paymentMap[order.order_number] || {};

              let paymentCode = pay.payment_code || '';
              let productName = pay.product_name || '';
              let stockOut = pay.stock_out || '';
              let slipHtml = pay.slip_image
                ? `<button class="view-slip" onclick="openSlip('../Admin_Payment/slips_Admin/${pay.slip_image}')">Slip</button>`
                : "";

              let priceInfo = order.total_amount ? Number(order.total_amount).toLocaleString() : "";

              tbody.innerHTML += `
                <tr data-status="${order.status}">
                  <td>${paymentCode}</td>
                  <td>${order.order_number || ''}</td>
                  <td>${order.email || ''}</td>
                  <td>${(order.firstname || '') + ' ' + (order.lastname || '')}</td>
                  <td>${productName}</td>
                  <td>${stockOut}</td>
                  <td>${priceInfo}</td>
                  <td><span class="status ${statusClass}">${order.status || ''}</span></td>
                  <td>${slipHtml}</td>
                  <td><button class="btn-edit" onclick="openModal(this)">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button></td>
                </tr>`;
            });
          } else {
            tbody.innerHTML = `<tr><td colspan="10">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</td></tr>`;
          }

          document.getElementById("totalCount").textContent = total;
          document.getElementById("cancelCount").textContent = cancel;
          document.getElementById("checkingCount").textContent = checking;
          document.getElementById("successCount").textContent = success;
          document.getElementById("prepareCount").textContent = prepare;
        });
    }

    document.addEventListener("DOMContentLoaded", loadPayments);

    // ================== Sidebar Navigation ==================
    document.addEventListener("DOMContentLoaded", function () {
      document.getElementById("dashboardMenu").onclick = () => window.location.href = "../Admin_index/Admin_index.html";
      document.getElementById("productMenu").onclick = () => window.location.href = "../admin_products/admin_products.html";
      document.getElementById("paymentMenu").onclick = () => window.location.href = "../Admin_Payment/Admin_Payment.html";
      document.getElementById("reportMenu").onclick = () => window.location.href = "../Admin_report/Admin_report.html";
      document.getElementById("profileMenu").onclick = () => window.location.href = "../Admin_personal information/personal information.html";
      document.getElementById("logoutBtn").onclick = () => window.location.href = "../Admin/Admin.html";

      // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
      fetch("../Admin/get_admin_profile.php")
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            document.getElementById("adminProfileEmail").textContent = data.email || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏µ‡πÄ‡∏°‡∏•";
            document.querySelector(".admin-name").textContent =
              (data.firstname || "") + (data.lastname ? " " + data.lastname : "");
          } else {
            document.getElementById("adminProfileEmail").textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏µ‡πÄ‡∏°‡∏•";
          }
        })
        .catch(() => {
          document.getElementById("adminProfileEmail").textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏µ‡πÄ‡∏°‡∏•";
        });
    });
  </script>
</body>

</html>