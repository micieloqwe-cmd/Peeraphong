<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Football Store</title>
  <link rel="stylesheet" href="View index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">
      <img src="../uploads/h0-Photoroom.jpg" alt="logo">
      <span>Football Store</span>
    </div>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="ค้นหาชื่อรุ่นหรือยี่ห้อ...">
      <button class="nav-search-btn" id="searchBtn"><i class="fas fa-search"></i></button>
    </div>
    <div style="display:flex;align-items:center;gap:10px;">
      <a href="#" class="cart-icon" title="ตะกร้าสินค้า" id="guestCartBtn"><i class=""></i></a>
      <a href="../Login/login.html" class="login-btn" style="background:#fff;color:#0d47a1;font-weight:600;padding:8px 18px;border-radius:20px;text-decoration:none;box-shadow:0 2px 6px rgba(0,0,0,0.1);"><i class="fas fa-sign-in-alt"></i> เข้าสู่ระบบ</a>
      <a href="../Register/apply.html" class="register-btn" style="background:#fff;color:#0d47a1;font-weight:600;padding:8px 18px;border-radius:20px;text-decoration:none;box-shadow:0 2px 6px rgba(0,0,0,0.1);"><i class="fas fa-user-plus"></i> สมัครสมาชิก</a>
      <a href="../Admin/Admin.html" class="register-btn" style="background:#fff;color:#0d47a1;font-weight:600;padding:8px 18px;border-radius:20px;text-decoration:none;box-shadow:0 2px 6px rgba(0,0,0,0.1);"><i class="fas fa-user-plus"></i> ผู้ดูแลระบบ</a>
    </div>
  </nav>

  <!-- Categories -->
  <main>
    <section class="categories">
      <h2>ประเภทอุปกรณ์ฟุตบอล</h2>
      <div class="category-icons" id="categoryIcons"></div>
    </section>

    <!-- Products -->
    <section class="products">
      <h3>สินค้า</h3>
      <div class="product-list" id="productList"></div>
      <div class="more-button">
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <h4>⚽ Football Store</h4>
    <p>ร้านขายอุปกรณ์ฟุตบอลครบวงจร</p>
    <div class="social-icons"></div>
    <p style="margin-top:10px; font-size:13px;">© 2025 Football Store. All rights reserved.</p>
  </footer>

  <script>
    // ================= Load Categories & Products =================
    let allProducts = [];
    let allCategories = [];

    fetch('View get_products.php')
      .then(async res => {
        // ตรวจสอบ response ว่าเป็น JSON จริงหรือไม่
        const text = await res.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch (e) {
          alert("เกิดข้อผิดพลาดในการโหลดข้อมูลสินค้า/หมวดหมู่\n" + text);
          console.error("JSON parse error:", text);
          return;
        }
        // หมวดหมู่
        allCategories = data.categories || [];
        const catContainer = document.getElementById('categoryIcons');
        catContainer.innerHTML = "";
        if (allCategories.length) {
          allCategories.forEach(cat => {
            const imgSrc = cat.image ? `../${cat.image}` : "../uploads/placeholder.png";
            const div = document.createElement('div');
            div.innerHTML = `
              <img src="${imgSrc}" alt="${cat.category_name}">
              <div>${cat.category_name}</div>
            `;
            div.style.cursor = "pointer";
            div.addEventListener('click', () => {
              filterByCategory(cat.category_id);
            });
            catContainer.appendChild(div);
          });
        }
        // สินค้า
        allProducts = data.products || [];
        renderProducts(allProducts);
      })
      .catch(err => {
        alert("เกิดข้อผิดพลาดในการเชื่อมต่อเซิร์ฟเวอร์");
        console.error(err);
      });

    function renderProducts(products) {
      const container = document.getElementById('productList');
      container.innerHTML = "";
      if (products.length === 0) {
        container.innerHTML = "<div style='text-align:center;color:#888;font-size:18px;'>ไม่พบสินค้า</div>";
        return;
      }
      products.forEach(p => {
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
          <img src="../${p.image}" alt="${p.product_name}" style="cursor:pointer" onclick="viewProduct(${p.product_id})">
          <h4 style="cursor:pointer" onclick="viewProduct(${p.product_id})">${p.product_name}</h4>
          <p>${Number(p.price).toLocaleString()} บาท</p>
          <button class="view-detail" onclick="viewProduct(${p.product_id})">ดูรายละเอียดสินค้า</button>
        `;
        container.appendChild(div);
      });
    }

    function viewProduct(id) {
      window.location.href = `View product.html?product_id=${id}`;
    }

    function filterByCategory(catId) {
      window.location.href = `View category.html?cat=${catId}`;
    }

    function searchProducts() {
      const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
      let filtered = allProducts;
      if (keyword) {
        filtered = filtered.filter(p =>
          (p.product_name && p.product_name.toLowerCase().includes(keyword)) ||
          (p.brand && p.brand.toLowerCase().includes(keyword))
        );
      }
      renderProducts(filtered);
    }

    document.getElementById('searchBtn').addEventListener('click', searchProducts);
    document.getElementById('searchInput').addEventListener('keyup', function(e) {
      if (e.key === 'Enter') searchProducts();
      if (!this.value) renderProducts(allProducts);
    });

    document.getElementById('loadMoreBtn').addEventListener('click', function() {
      alert("โหลดสินค้าเพิ่มเติม (ฟังก์ชันตัวอย่าง)");
    });

    document.getElementById('guestCartBtn').addEventListener('click', function(e) {
      e.preventDefault();
      alert("กรุณาสมัครสมาชิกหรือเข้าสู่ระบบก่อนใช้งานตะกร้าสินค้า");
    });
  </script>
</body>
</html>