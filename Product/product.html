<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>รายละเอียดสินค้า - Football Store</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="product.css">
</head>

<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="logo">
      <span>Football Store</span>
    </div>
    <div class="nav-links">
      <a href="../index/index.html"><i class="fas fa-home"></i> หน้าหลัก</a>
      <a href="../Product/basket.html"><i class="fas fa-shopping-cart"></i> ตะกร้า</a>
      <a href="../order-history/order-history.html"><i class="fas fa-receipt"></i> ประวัติการสั่งซื้อ</a>
    </div>
    <div class="profile-section">
      <img src="../uploads/iconprofile.jpg" alt="โปรไฟล์" class="profile-icon" id="profileIcon" />
      <div class="dropdown" id="profileDropdown"
        style="background:#fff;border-radius:18px;box-shadow:0 8px 24px rgba(13,71,161,0.13);padding:26px 18px;width:265px;text-align:center;">
        <div class="profile-info" style="margin-bottom:16px;">
          <h4 style="color:#0d47a1;font-size:1.18rem;font-weight:700;margin-bottom:10px;">
            <i class="fas fa-user-circle"></i> ข้อมูลส่วนตัว
          </h4>
          <img id="userImg" src="../uploads/iconprofile.jpg" alt="User Image"
            style="width:74px;height:74px;border-radius:50%;margin:10px 0;box-shadow:0 2px 8px rgba(13,71,161,0.12);border:2px solid #0d47a1;">
          <p id="userFullname" style="font-size:1.08rem;color:#004d40;font-weight:600;margin-bottom:4px;">
            <i class="fas fa-user"></i> กำลังโหลด...
          </p>
          <p id="userEmail" style="font-size:1.05rem;color:#1565c0;margin-bottom:8px;">
            <i class="fas fa-envelope"></i> กำลังโหลด...
          </p>
        </div>
        <button onclick="window.location.href='../Edit_profile/edit_profile.html'"
          style="background:linear-gradient(90deg,#004d40,#0d47a1);color:#fff;border:none;border-radius:25px;padding:12px 0;font-weight:600;margin-bottom:10px;cursor:pointer;font-size:1rem;">
          <i class="fas fa-edit"></i> แก้ไขข้อมูลส่วนตัว
        </button>
        <button onclick="logout()"
          style="background:linear-gradient(90deg,#e53935,#b71c1c);color:#fff;border:none;border-radius:25px;padding:12px 0;font-weight:600;cursor:pointer;font-size:1rem;">
          <i class="fas fa-sign-out-alt"></i> ออกจากระบบ
        </button>
      </div>
    </div>
  </header>

  <!-- Main Product -->
  <main class="product-container" style="display:flex;justify-content:center;align-items:center;">
    <div class="product-box"
      style="display:flex;gap:40px;flex-wrap:wrap;justify-content:center;align-items:center;width:100%;">
      <!-- Left -->
      <div class="left-side"
        style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;">
        <button class="back-btn" onclick="history.back()"
          style="background:linear-gradient(90deg,#004d40,#0d47a1);color:#fff;border:none;border-radius:50%;padding:10px 16px;font-size:1.3rem;box-shadow:0 2px 8px rgba(13,71,161,0.12);margin-bottom:18px;transition:0.2s;">←</button>
        <img id="productImg" src="" alt="" class="product-image"
          style="margin-bottom:18px;display:block;margin-left:auto;margin-right:auto;">
        <div class="product-description"
          style="background:#f1f8e9;padding:22px 24px;border-radius:16px;box-shadow:0 3px 10px rgba(0,0,0,0.08);margin-top:10px;max-width:400px;">
          <h2
            style="color:#0d47a1;font-size:1.3rem;font-weight:700;margin-bottom:12px;letter-spacing:1px;text-align:center;">
            รายละเอียดสินค้า</h2>
          <div id="productDesc" style="font-size:1.08rem;line-height:2;color:#222;text-align:left;"></div>
        </div>
      </div>

      <!-- Right -->
      <div class="right-side"
        style="background:#f9fafb;border-radius:16px;padding:28px 24px;box-shadow:0 2px 8px rgba(13,71,161,0.08);display:flex;flex-direction:column;gap:18px;min-width:320px;align-items:center;justify-content:center;">
        <h2 id="productName"
          style="color:#0d47a1;font-size:2rem;font-weight:700;margin-bottom:10px;text-shadow:0 2px 6px rgba(13,71,161,0.08);text-align:center;">
        </h2>
        <div class="size-section" id="sizeSection" style="display:none;">
          <label style="font-weight:600;color:#004d40;">SIZE (ขนาด)</label>
          <div class="sizes" id="sizes" style="margin-top:8px;text-align:center;"></div>
        </div>

        <div class="quantity-section"
          style="margin-top:10px;width:100%;display:flex;flex-direction:column;align-items:center;">
          <label style="font-weight:600;color:#004d40;">จำนวน</label>
          <div class="quantity-control" style="margin-top:8px;display:flex;align-items:center;justify-content:center;">
            <button onclick="decreaseQty()"
              style="background:#0d47a1;color:#fff;border:none;border-radius:8px;padding:8px 16px;font-size:1.2rem;font-weight:700;cursor:pointer;">−</button>
            <span id="qty" style="font-size:1.2rem;font-weight:700;margin:0 12px;">1</span>
            <button onclick="increaseQty()"
              style="background:#0d47a1;color:#fff;border:none;border-radius:8px;padding:8px 16px;font-size:1.2rem;font-weight:700;cursor:pointer;">+</button>
          </div>
          <p class="stock" style="margin-top:8px;font-size:1rem;color:#16a34a;font-weight:600;text-align:center;">เหลือ
            <span id="stock">0</span> ชิ้น
          </p>
        </div>

        <div class="button-group" style="margin-top:18px;display:flex;gap:14px;width:100%;justify-content:center;">
          <button class="btn secondary" id="addToCartBtn" onclick="addToCart()"
            style="background:#fff;border:2px solid #0d47a1;color:#0d47a1;border-radius:12px;padding:14px;font-size:1rem;font-weight:600;cursor:pointer;transition:0.3s;">เพิ่มลงตะกร้า</button>
          <button class="btn primary" id="buyNowBtn" onclick="buyNow()"
            style="background:linear-gradient(90deg,#004d40,#0d47a1);color:#fff;border:none;border-radius:12px;padding:14px;font-size:1rem;font-weight:600;cursor:pointer;transition:0.3s;">สั่งซื้อทันที</button>
        </div>
        <p class="price"
          style="font-size:2rem;color:#004d40;font-weight:700;margin-top:10px;text-shadow:1px 1px 2px rgba(0,77,64,0.10);text-align:center;">
          <b id="productPrice"></b> บาท
        </p>
      </div>
    </div>
  </main>

  <!-- Script -->
  <script>
    let qty = 1;
    let maxStock = 1;
    let product = null;
    let selectedSize = "";

    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }
    const productId = getQueryParam('product_id');

    fetch('../index/get_products.php')
      .then(res => res.json())
      .then(data => {
        const products = data.products || [];
        product = products.find(p => String(p.product_id) === String(productId));
        if (!product) {
          alert("ไม่พบสินค้า");
          return;
        }
        document.getElementById('productImg').src = "../" + product.image;
        document.getElementById('productName').textContent = product.product_name;
        document.getElementById('productPrice').textContent = Number(product.price).toLocaleString();
        document.getElementById('stock').textContent = product.stock;
        maxStock = Number(product.stock) || 1;
        document.getElementById('qty').textContent = qty;

        // ปิดปุ่มถ้า stock = 0
        const addToCartBtn = document.getElementById('addToCartBtn');
        const buyNowBtn = document.getElementById('buyNowBtn');
        if (Number(product.stock) <= 0) {
          addToCartBtn.disabled = true;
          buyNowBtn.disabled = true;
          addToCartBtn.style.opacity = "0.6";
          buyNowBtn.style.opacity = "0.6";
          addToCartBtn.style.cursor = "not-allowed";
          buyNowBtn.style.cursor = "not-allowed";
        } else {
          addToCartBtn.disabled = false;
          buyNowBtn.disabled = false;
          addToCartBtn.style.opacity = "";
          buyNowBtn.style.opacity = "";
          addToCartBtn.style.cursor = "";
          buyNowBtn.style.cursor = "";
        }

        // สวยงามและเข้าใจง่าย
        document.getElementById('productDesc').innerHTML = `
          <div style="margin-bottom:8px;">
            <span style="font-weight:600;color:#004d40;">รุ่น:</span> ${product.product_name}
          </div>
          <div style="margin-bottom:8px;">
            <span style="font-weight:600;color:#004d40;">แบรนด์:</span> ${product.brand}
          </div>
          <div style="margin-bottom:8px;">
            <span style="font-weight:600;color:#004d40;">ราคา:</span> <span style="color:#e53935;font-weight:700;">${Number(product.price).toLocaleString()} บาท</span>
          </div>
          <div style="margin-bottom:8px;">
            <span style="font-weight:600;color:#004d40;">สาขา:</span> ${product.branch}
          </div>
          <div style="margin-bottom:8px;">
            <span style="font-weight:600;color:#004d40;">หมวดหมู่:</span> <span style="background:#e3f2fd;color:#0d47a1;padding:2px 10px;border-radius:8px;">${product.category_id}</span>
          </div>
          <div>
            <span style="font-weight:600;color:#004d40;">จำนวนในสต็อก:</span> <span style="color:#16a34a;font-weight:700">${product.stock}</span> ชิ้น
          </div>
        `;

        // เลือก Size ตามประเภทสินค้า
        let sizeOptions = [];
        switch (Number(product.category_id)) {
          case 2: // รองเท้าสตั๊ด
            sizeOptions = ["UK 7.5", "UK 8", "UK 8.5", "UK 9"];
            break;
          case 3: // เสื้อฟุตบอล
            sizeOptions = ["(S SIZE)", "(M SIZE)", "(L SIZE)", "(XL SIZE)"];
            break;
          case 4: // กางเกงบอล
            sizeOptions = ["(S SIZE)", "(M SIZE)", "(L SIZE)", "(XL SIZE)"];
            break;
          case 5: // สนับแข้ง
            sizeOptions = ["(S SIZE)", "(M SIZE)", "(L SIZE)"];
            break;
          case 6: // ถุงเท้า
            sizeOptions = ["ONE SIZE"];
            break;
        }
        if (sizeOptions.length > 0) {
          document.getElementById('sizeSection').style.display = '';
          document.getElementById('sizes').innerHTML = sizeOptions.map(s =>
            `<span class="size-btn" style="display:inline-block;margin:6px;padding:8px 14px;border:2px solid #0d47a1;border-radius:8px;cursor:pointer;font-weight:600;transition:0.3s;" onclick="selectSize(this)">${s}</span>`
          ).join('');
        }
      });

    // เลือกขนาด
    window.selectSize = function (el) {
      document.querySelectorAll('.size-btn').forEach(btn => {
        btn.style.background = '';
        btn.style.color = '';
      });
      el.style.background = '#0d47a1';
      el.style.color = '#fff';
      selectedSize = el.textContent;
    };

    function updateQtyDisplay() {
      document.getElementById('qty').textContent = qty;
    }
    function increaseQty() {
      if (qty < maxStock) { qty++; updateQtyDisplay(); }
    }
    function decreaseQty() {
      if (qty > 1) { qty--; updateQtyDisplay(); }
    }
    function addToCart() {
      if (!product) return;
      if (Number(product.stock) <= 0) {
        alert("สินค้าหมด ไม่สามารถเพิ่มลงตะกร้าได้");
        return;
      }
      let cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const idx = cart.findIndex(item => item.id == product.product_id);
      if (idx >= 0) {
        cart[idx].qty += qty;
      } else {
        cart.push({ id: product.product_id, name: product.product_name, price: Number(product.price), image: product.image, qty });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      alert(`เพิ่ม ${product.product_name} จำนวน ${qty} ชิ้น ลงในตะกร้าแล้ว`);
    }
    function buyNow() {
      if (!product) return;
      if (Number(product.stock) <= 0) {
        alert("สินค้าหมด ไม่สามารถสั่งซื้อได้");
        return;
      }
      addToCart();
      window.location.href = "basket.html";
    }

    // โปรไฟล์ dropdown
    const profileIcon = document.getElementById("profileIcon");
    const profileDropdown = document.getElementById("profileDropdown");
    profileIcon.addEventListener("click", () => {
      profileDropdown.classList.toggle("show");
    });
    document.addEventListener("click", e => {
      if (!profileDropdown.contains(e.target) && e.target !== profileIcon) {
        profileDropdown.classList.remove("show");
      }
    });
    function logout() { window.location.href = '../Login/Login.html'; }

    window.addEventListener("DOMContentLoaded", () => {
      fetch('../index/check_login.php')
        .then(res => res.json())
        .then(user => {
          if (!user.loggedIn) {
            alert("กรุณาเข้าสู่ระบบ");
            window.location.href = "../main/house.html";
            return;
          }
          document.getElementById("userFullname").innerHTML = `<i class="fas fa-user"></i> ${user.firstname || ''} ${user.lastname || ''}`;
          document.getElementById("userEmail").innerHTML = `<i class="fas fa-envelope"></i> ${user.email || 'ไม่มีอีเมล'}`;
          document.getElementById("userImg").src = "../uploads/iconprofile.jpg";
          document.getElementById("profileIcon").src = "../uploads/iconprofile.jpg";
        })
        .catch(err => console.error("Error:", err));
    });
  </script>
</body>

</html>