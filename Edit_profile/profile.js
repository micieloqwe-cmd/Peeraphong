// ข้อมูลอำเภอตามจังหวัด
const districts = {
  "กรุงเทพมหานคร": ["เขตพระนคร", "เขตดุสิต", "เขตบางรัก"],
  "สมุทรปราการ": ["เมืองสมุทรปราการ", "พระประแดง", "พระสมุทรเจดีย์"],
  "นนทบุรี": ["เมืองนนทบุรี", "บางบัวทอง", "บางใหญ่"],
  "ปทุมธานี": ["เมืองปทุมธานี", "คลองหลวง", "สามโคก"],
  "พระนครศรีอยุธยา": ["เมืองพระนครศรีอยุธยา", "บางปะอิน", "บางบาล"],
  "อ่างทอง": ["เมืองอ่างทอง", "ป่าโมก", "วิเศษชัยชาญ"],
  "ลพบุรี": ["เมืองลพบุรี", "ท่าหลวง", "โคกสำโรง"],
  "สิงห์บุรี": ["เมืองสิงห์บุรี", "บางระจัน", "ค่ายบางระจัน"],
  "ชัยนาท": ["เมืองชัยนาท", "เนินขาม", "วัดสิงห์"],
  "สระบุรี": ["เมืองสระบุรี", "หนองแค", "หนองโดน"],
  "ชลบุรี": ["เมืองชลบุรี", "บางละมุง", "พานทอง"],
  "ระยอง": ["เมืองระยอง", "บ้านฉาง", "แกลง"],
  "จันทบุรี": ["เมืองจันทบุรี", "ขลุง", "สอยดาว"],
  "ตราด": ["เมืองตราด", "เกาะช้าง", "เขาสมิง"],
  "ฉะเชิงเทรา": ["เมืองฉะเชิงเทรา", "บางน้ำเปรี้ยว", "บ้านโพธิ์"],
  "ปราจีนบุรี": ["เมืองปราจีนบุรี", "กบินทร์บุรี", "นาดี"],
  "นครนายก": ["เมืองนครนายก", "บ้านนา", "องครักษ์"],
  "สระแก้ว": ["เมืองสระแก้ว", "คลองหาด", "วังสมบูรณ์"],
  "นครราชสีมา": ["เมืองนครราชสีมา", "ครบุรี", "ปากช่อง"],
  "บุรีรัมย์": ["เมืองบุรีรัมย์", "ประโคนชัย", "นางรอง"],
  "สุรินทร์": ["เมืองสุรินทร์", "รัตนบุรี", "สนม"],
  "ศรีสะเกษ": ["เมืองศรีสะเกษ", "กันทรารมย์", "ขุขันธ์"],
  "อุบลราชธานี": ["เมืองอุบลราชธานี", "วารินชำราบ", "ตระการพืชผล"],
  "ยโสธร": ["เมืองยโสธร", "ค้อวัง", "ไทยเจริญ"],
  "ชัยภูมิ": ["เมืองชัยภูมิ", "ภูเขียว", "บ้านเขว้า"],
  "อำนาจเจริญ": ["เมืองอำนาจเจริญ", "ชานุมาน", "หัวตะพาน"],
  "บึงกาฬ": ["เมืองบึงกาฬ", "ปากคาด", "เซกา"],
  "หนองบัวลำภู": ["เมืองหนองบัวลำภู", "นากลาง", "ศรีบุญเรือง"],
  "ขอนแก่น": ["เมืองขอนแก่น", "ชุมแพ", "บ้านฝาง"],
  "อุดรธานี": ["เมืองอุดรธานี", "หนองวัวซอ", "กุมภวาปี"],
  "เลย": ["เมืองเลย", "วังสะพุง", "เชียงคาน"],
  "หนองคาย": ["เมืองหนองคาย", "ท่าบ่อ", "โพนพิสัย"],
  "มหาสารคาม": ["เมืองมหาสารคาม", "กันทรวิชัย", "โกสุมพิสัย"],
  "ร้อยเอ็ด": ["เมืองร้อยเอ็ด", "ปทุมรัตต์", "จตุรพักตรพิมาน"],
  "กาฬสินธุ์": ["เมืองกาฬสินธุ์", "กมลาไสย", "เขาวง"],
  "สกลนคร": ["เมืองสกลนคร", "พรรณานิคม", "วานรนิวาส"],
  "นครพนม": ["เมืองนครพนม", "ปลาปาก", "เรณูนคร"],
  "มุกดาหาร": ["เมืองมุกดาหาร", "นิคมคำสร้อย", "หว้านใหญ่"],
  "เชียงใหม่": ["เมืองเชียงใหม่", "สารภี", "แม่ริม"],
  "ลำพูน": ["เมืองลำพูน", "ป่าซาง", "แม่ทา"],
  "ลำปาง": ["เมืองลำปาง", "เกาะคา", "แม่เมาะ"],
  "อุตรดิตถ์": ["เมืองอุตรดิตถ์", "ฟากท่า", "น้ำปาด"],
  "แพร่": ["เมืองแพร่", "ร้องกวาง", "สูงเม่น"],
  "น่าน": ["เมืองน่าน", "ท่าวังผา", "เวียงสา"],
  "พะเยา": ["เมืองพะเยา", "เชียงคำ", "จุน"],
  "เชียงราย": ["เมืองเชียงราย", "แม่จัน", "แม่สาย"],
  "แม่ฮ่องสอน": ["เมืองแม่ฮ่องสอน", "ขุนยวม", "ปาย"],
  "นครสวรรค์": ["เมืองนครสวรรค์", "ตาคลี", "โกรกพระ"],
  "อุทัยธานี": ["เมืองอุทัยธานี", "ลานสัก", "หนองฉาง"],
  "กำแพงเพชร": ["เมืองกำแพงเพชร", "ไทรงาม", "คลองลาน"],
  "ตาก": ["เมืองตาก", "แม่สอด", "พบพระ"],
  "สุโขทัย": ["เมืองสุโขทัย", "ศรีสัชนาลัย", "สวรรคโลก"],
  "พิษณุโลก": ["เมืองพิษณุโลก", "บางระกำ", "วัดโบสถ์"],
  "พิจิตร": ["เมืองพิจิตร", "วชิรบารมี", "ตะพานหิน"],
  "เพชรบูรณ์": ["เมืองเพชรบูรณ์", "หล่มสัก", "หล่มเก่า"],
  "ราชบุรี": ["เมืองราชบุรี", "ดำเนินสะดวก", "บ้านโป่ง"],
  "กาญจนบุรี": ["เมืองกาญจนบุรี", "ไทรโยค", "ท่ามะกา"],
  "สุพรรณบุรี": ["เมืองสุพรรณบุรี", "เดิมบางนางบวช", "ศรีประจันต์"],
  "นครปฐม": ["เมืองนครปฐม", "กำแพงแสน", "บางเลน"],
  "สมุทรสาคร": ["เมืองสมุทรสาคร", "กระทุ่มแบน", "บ้านแพ้ว"],
  "สมุทรสงคราม": ["เมืองสมุทรสงคราม", "บางคนที", "อัมพวา"],
  "เพชรบุรี": ["เมืองเพชรบุรี", "ชะอำ", "ท่ายาง"],
  "ประจวบคีรีขันธ์": ["เมืองประจวบคีรีขันธ์", "กุยบุรี", "บางสะพาน"],
  "นครศรีธรรมราช": ["เมืองนครศรีธรรมราช", "ท่าศาลา", "พรหมคีรี"],
  "กระบี่": ["เมืองกระบี่", "อ่าวลึก", "เกาะลันตา"],
  "พังงา": ["เมืองพังงา", "ตะกั่วทุ่ง", "เกาะยาว"],
  "ภูเก็ต": ["เมืองภูเก็ต", "กะทู้", "ถลาง"],
  "สุราษฎร์ธานี": ["เมืองสุราษฎร์ธานี", "ไชยา", "กาญจนดิษฐ์"],
  "ระนอง": ["เมืองระนอง", "กะเปอร์", "สุขสำราญ"],
  "ชุมพร": ["เมืองชุมพร", "ท่าแซะ", "ละแม"],
  "สงขลา": ["เมืองสงขลา", "หาดใหญ่", "สะเดา"],
  "สตูล": ["เมืองสตูล", "ทุ่งหว้า", "ละงู"],
  "ตรัง": ["เมืองตรัง", "กันตัง", "ย่านตาขาว"],
  "พัทลุง": ["เมืองพัทลุง", "ควนขนุน", "ปากพะยูน"],
  "ปัตตานี": ["เมืองปัตตานี", "ยะหริ่ง", "หนองจิก"],
  "ยะลา": ["เมืองยะลา", "เบตง", "ยะหา"],
  "นราธิวาส": ["เมืองนราธิวาส", "ตากใบ", "บาเจาะ"]
};

// สร้าง <option> จังหวัดอัตโนมัติ
const provinceSelect = document.getElementById('province');
Object.keys(districts).forEach(province => {
  const opt = document.createElement('option');
  opt.value = province;
  opt.textContent = province;
  provinceSelect.appendChild(opt);
});

// อัปเดตอำเภออัตโนมัติ
const districtSelect = document.getElementById('district');
provinceSelect.addEventListener('change', () => updateDistrict(provinceSelect.value));

function updateDistrict(province, selected='') {
  districtSelect.innerHTML = '<option value="">-- เลือกอำเภอ --</option>';
  if (districts[province]) {
    districts[province].forEach(d => {
      const opt = document.createElement('option');
      opt.value = d;
      opt.textContent = d;
      if(d === selected) opt.selected = true;
      districtSelect.appendChild(opt);
    });
  }
}

// โหลดข้อมูลผู้ใช้และเติมฟอร์ม
document.addEventListener('DOMContentLoaded', () => {
  fetch('get_profile.php')
    .then(res => res.json())
    .then(data => {
      if(data.success && data.data) {
        document.getElementById('first_name').value = data.data.first_name || '';
        document.getElementById('last_name').value = data.data.last_name || '';
        document.getElementById('phone').value = data.data.phone || '';
        document.getElementById('house_number').value = data.data.house_number || '';
        document.getElementById('road').value = data.data.road || '';
        document.getElementById('soi').value = data.data.soi || '';
        document.getElementById('subdistrict').value = data.data.subdistrict || '';
        if(data.data.province) {
          provinceSelect.value = data.data.province;
          updateDistrict(data.data.province, data.data.district || '');
        }
      }
    });
});

document.getElementById('profileForm').addEventListener('submit', function(e){
    e.preventDefault();
    let formData = new FormData(this);

    fetch('edit_profile.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        let message = document.getElementById('message');
        message.textContent = data.message;

        if(data.success) {
            message.style.color = 'green';
            setTimeout(() => {
                window.location.href = '../index/index.html';
            }, 1500);
        } else {
            message.style.color = 'red';
        }
    })
    .catch(error => console.error('Error:', error));
});
const form = document.getElementById("profileForm");
const messageDiv = document.getElementById("message");
const submitBtn = document.getElementById("submitBtn");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  // แสดงข้อความระหว่างอัปเดต
  messageDiv.style.display = "block";
  messageDiv.style.color = "#0d47a1";
  messageDiv.textContent = "⏳ กำลังอัพเดทข้อมูล...";

  submitBtn.disabled = true; // ป้องกันการกดซ้ำ
  submitBtn.style.opacity = "0.6";
});


